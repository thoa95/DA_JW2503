<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/main}">

<head>
<title>Lịch sử đặt phòng || Hotel Booking</title>
<style>
/* Nút hủy màu đỏ khi được phép hủy */
.btn-cancel-active {
	background-color: #dc3545 !important;
	border: 1px solid #dc3545 !important;
	color: white !important;
	padding: 6px 14px;
	border-radius: 8px;
	font-weight: bold;
	display: inline-block;
}

/* Nút hủy màu xám khi disabled */
.btn-cancel-disabled {
	background-color: #b5b5b5 !important;
	border: 1px solid #9e9e9e !important;
	color: white !important;
	padding: 6px 14px;
	border-radius: 8px;
	font-weight: bold;
	display: inline-block;
	cursor: not-allowed !important;
	pointer-events: none !important; /* khoá click */
	opacity: 1 !important;
}

/* Nút Xuất hóa đơn */
.btn-small-long {
	font-size: 14px !important;
	padding: 6px 14px !important;
	height: 36px !important;
	border-radius: 10px !important;
}
</style>

</head>

<body data-spy="scroll" data-target=".fixed-top">

	<div layout:fragment="content">
		<div class="container py-5">
			<h2 class="mb-4 text-center fw-bold">Lịch sử đặt phòng</h2>

			<!-- Khi không có đơn -->
			<div th:if="${#lists.isEmpty(bookings)}"
				class="alert alert-info text-center">Bạn chưa có đơn đặt phòng
				nào.</div>

			<!-- Khi có đơn -->
			<div th:if="${!#lists.isEmpty(bookings)}" class="table-responsive">
				<table class="table table-hover align-middle shadow-sm">
					<thead class="table-primary">
						<tr>
							<th>Số thứ tự</th>
							<th>Mã đặt phòng</th>
							<th>Ngày đặt</th>
							<th>Tổng tiền</th>
							<th>Trạng thái thanh toán</th>
							<th>Chi tiết</th>
							<!-- Đã bỏ cột Tình trạng -->
						</tr>
					</thead>

					<tbody>
						<tr th:each="b, iStat : ${bookings}">
							<td th:text="${iStat.index + 1}"></td>

							<td th:text="${b.id}"></td>

							<td th:text="${#dates.format(b.createdAt, 'dd/MM/yyyy HH:mm')}"></td>

							<td
								th:text="${#numbers.formatDecimal(b.totalAmount, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'"></td>

							<!-- Trạng thái thanh toán -->
							<td><span th:if="${b.isCancel == 1}">Đã hủy</span> <span
								th:if="${b.isCancel == 0 and b.paymentStatus == 'PAID'}">Đã
									thanh toán</span> <span
								th:if="${b.isCancel == 0 and b.paymentStatus != 'PAID'}">Chưa
									thanh toán</span></td>

							<td>
								<!-- Nút xuất hóa đơn --> <a 
								th:href="@{'/booking/invoice/' + ${b.id}}"
								class="btn btn-primary btn-small-long me-2"> Xuất Hóa Đơn </a> <!-- LINK HỦY (a) -->
								<a
								th:if="${
            b.isCancel == 0
            and !(
                roomsMap[b.id] != null
                and #lists.size(roomsMap[b.id]) > 0
                and roomsMap[b.id].get(0).checkOutDate.before(now)
            )
        }"
								th:href="@{'/booking/cancel/' + ${b.id}}"
								class="btn-cancel-active"
								onclick="return confirm('Bạn có chắc muốn hủy đơn này không?')">
									Hủy </a> <!-- LINK DISABLED --> <a
								th:if="${
            b.isCancel == 1
            or (
                roomsMap[b.id] != null
                and #lists.size(roomsMap[b.id]) > 0
                and roomsMap[b.id].get(0).checkOutDate.before(now)
            )
        }"
								class="btn-cancel-disabled"> Hủy </a>
							</td>



						</tr>
					</tbody>
				</table>

			</div>

		</div>
	</div>

</body>
</html>
